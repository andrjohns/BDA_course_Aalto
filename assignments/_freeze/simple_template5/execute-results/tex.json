{
  "hash": "af07e9c63405ab03d667e38924a9a2b2",
  "result": {
    "markdown": "---\ntitle: \"Assignment 5\"\nauthor: anonymous # <-- hand in anonymously\nformat: \n  html:\n    toc: true\n    code-tools: true\n    code-line-numbers: true\n    standalone: true\n    self-contained: true\n    embed-resources: true  \n    number-sections: true\n    mainfont: Georgia, serif\n    linkcolor: \"#212529\"\n    fontsize: 1.2em\n    page-layout: article\n  pdf:  \n    documentclass: article\n    number-sections: true\nreference-location: margin\ncitation-location: margin \ncomments:\n  hypothesis: true\neditor: source\n---\n\n\n\n\n# General information\n::: {.callout-important}\n# Reporting accuracy\n\n**For posterior statistics of interest, only\nreport digits for which the Monte Carlo standard error (MCSE) is zero.**\n\n*Example:* If you estimate $E(\\mu)=1.234$ with MCSE($E(\\mu)$) = 0.01,\nyou should report $E(\\mu)=1.2$.\n\nSee lecture video 4.1, [the chapter\nnotes](https://avehtari.github.io/BDA_course_Aalto/chapter_notes/BDA_notes_ch10.pdf),\nand [a case\nstudy](https://avehtari.github.io/casestudies/Digits/digits.html) for\nmore information.\n:::\n\n\n:::: {.content-hidden when-format=\"pdf\"}\n::: {.callout-warning collapse=false}\n \n## Setup \n\n\n*This block will only be visible in your HTML output, but will be hidden when rendering to PDF with quarto for the submission.*\n**Make sure that this does not get displayed in the PDF!**\n            \n\n\n\nThis is the template for [assignment 5](assignment5.html). You can download the [qmd-file](https://raw.githubusercontent.com/avehtari/BDA_course_Aalto/gh-pages/assignments/template5.qmd) or copy the code from this rendered document after clicking on `</> Code` in the top right corner.\n\n**Please replace the instructions in this template by your own text, explaining what you are doing in each exercise.** \n\nThe following will set-up [`markmyassignment`](https://github.com/MansMeg/markmyassignment) to check your functions at the end of the notebook:\n \n\n\n::: {.cell}\n\n```{.r .cell-code}\nif(!require(markmyassignment)){\n    install.packages(\"markmyassignment\")\n    library(markmyassignment)\n}\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: markmyassignment\n```\n:::\n\n```{.r .cell-code}\nassignment_path = paste(\"https://github.com/avehtari/BDA_course_Aalto/\",\n\"blob/master/assignments/tests/assignment5.yml\", sep=\"\")\nset_assignment(assignment_path)    \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nAssignment set:\nassignment5: Bayesian Data Analysis: Assignment 5\nThe assignment contain the following task:\n- density_ratio\n```\n:::\n:::\n\n\n\nThe following installs and loads the `aaltobda` package:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif(!require(aaltobda)){\n    install.packages(\"remotes\")\n    remotes::install_github(\"avehtari/BDA_course_Aalto\", subdir = \"rpackage\", upgrade=\"never\")\n    library(aaltobda)\n}\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: aaltobda\n```\n:::\n:::\n\n\nThe following installs and loads the [`latex2exp` package](https://github.com/stefano-meschiari/latex2exp), which allows us to use LaTeX in plots:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif(!require(latex2exp)){\n    install.packages(\"latex2exp\")\n    library(latex2exp)\n}\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: latex2exp\n```\n:::\n:::\n\n\nThe following installs and loads the [`posterior` package](https://github.com/stan-dev/posterior) which imports the `rhat_basic()` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif(!require(posterior)){\n    install.packages(\"posterior\")\n    library(posterior)\n}\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: posterior\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThis is posterior version 1.4.0\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'posterior'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:aaltobda':\n\n    mcse_quantile\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    mad, sd, var\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    %in%, match\n```\n:::\n:::\n\n\nThe following installs and loads the [`ggplot2` package](https://ggplot2.tidyverse.org/) and the [`bayesplot` package](https://mc-stan.org/bayesplot/index.html)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif(!require(ggplot2)){\n    install.packages(\"ggplot2\")\n    library(ggplot2)\n}\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: ggplot2\n```\n:::\n\n```{.r .cell-code}\nif(!require(bayesplot)){\n    install.packages(\"bayesplot\")\n    library(bayesplot)\n}\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: bayesplot\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThis is bayesplot version 1.10.0\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n- Online documentation and vignettes at mc-stan.org/bayesplot\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n- bayesplot theme set to bayesplot::theme_default()\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n   * Does _not_ affect other ggplot2 plots\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n   * See ?bayesplot_theme_set for details on theme setting\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'bayesplot'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:posterior':\n\n    rhat\n```\n:::\n:::\n\n\n\n:::\n::::\n\n\n# Generalized linear model: Bioassay model with Metropolis \n## (a)\n\n\n**Write your answers/code here!**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Useful functions: runif, rnorm\n# bioassaylp, dmvnorm (from aaltobda)\n\ndata(\"bioassay\")\n# Start by implementing a function called `density_ratio` to\n# compute the density ratio function, $r$ in Eq. (11.1) in BDA3:\ndensity_ratio <- function(alpha_propose, alpha_previous, beta_propose, beta_previous, x, y, n){\n    # Do computation here, and return as below.\n    # Below are the correct return values for two different calls of this function:\n\n    # alpha_propose = 1.89, alpha_previous = 0.374,\n    # beta_propose = 24.76, beta_previous = 20.04,\n    # x = bioassay$x, y = bioassay$y, n = bioassay$n\n    1.305179\n\n    # alpha_propose = 0.374, alpha_previous = 1.89,\n    # beta_propose = 20.04, beta_previous = 24.76,\n    # x = bioassay$x, y = bioassay$y, n = bioassay$n\n    0.7661784\n    \n}\n# Then implement a function called `metropolis_bioassay()` which\n# implements the Metropolis algorithm using the `density_ratio()`:\nmetropolis_bioassay <- function(alpha_initial, beta_initial, alpha_sigma, beta_sigma, no_draws, x, y, n){\n    # Do computation here, and return as below.\n    # Below are \"wrong\" values (unlikely to actually occur) \n    # in the \"correct\" format (such that they work with the plotting functions further down).\n    data.frame(\n        alpha=c(alpha_initial, alpha_initial+alpha_sigma, alpha_initial-alpha_sigma), \n        beta=c(beta_initial, beta_initial+beta_sigma, beta_initial-beta_sigma)\n    )\n    \n}\ndf = metropolis_bioassay(0, 0, 1, 1, 1000, bioassay$x, bioassay$y, bioassay$n)\n```\n:::\n\n\n\n\n## (b)\n\n\n**Write your answers/code here!**\n\nHave a look at [`bayesplot` trace plot examples](http://mc-stan.org/bayesplot/reference/MCMC-traces.html#examples) and tune your plot if wanted/needed. Don't forget to include a title/caption/description.\n\n**The below example plot only includes a single chain, but your report should include a plot with multiple chains overlayed!**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Useful functions: mcmc_trace (from bayesplot)\nmcmc_trace(df, pars=c(\"alpha\", \"beta\"))\n```\n\n::: {.cell-output-display}\n![](simple_template5_files/figure-pdf/unnamed-chunk-7-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n## (c)\n\n\n**Write your answers/code here!**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Useful functions: rhat_basic (from posterior)\n```\n:::\n\n\n\n\n## (c)\n\n\n**Write your answers/code here!**\n\nHave a look at [`bayesplot` scatter plot examples](https://mc-stan.org/bayesplot/reference/MCMC-scatterplots.html#examples) and tune your plot if wanted/needed. Don't forget to include a title/caption/description.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Useful functions: mcmc_scatter (from bayesplot)\nmcmc_scatter(df, pars=c(\"alpha\", \"beta\"))\n```\n\n::: {.cell-output-display}\n![](simple_template5_files/figure-pdf/unnamed-chunk-9-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n:::: {.content-hidden when-format=\"pdf\"}\n::: {.callout-warning collapse=false}\n\n## markmyassignment\n\n\n*This block will only be visible in your HTML output, but will be hidden when rendering to PDF with quarto for the submission.*\n**Make sure that this does not get displayed in the PDF!**\n            \n\n\nThe following will check the functions for which `markmyassignment` has been set up:\n \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmark_my_assignment()    \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nv | F W S  OK | Context\n\n/ |         0 | task-1-subtask-1-tests                                          \n/ |         0 | density_ratio()                                                 \nx | 3       3 | density_ratio()\n--------------------------------------------------------------------------------\nFailure ('test-task-1-subtask-1-tests.R:14:3'): density_ratio()\ndensity_ratio(...) not equivalent to 1.305179.\n1/1 mismatches\n[1] 0.766 - 1.31 == -0.539\nError: Incorrect result for alpha_propose = 1.89, alpha_previous = 0.374, beta_propose = 24.76 and beta_previous = 20.04.\n\nFailure ('test-task-1-subtask-1-tests.R:26:3'): density_ratio()\ndensity_ratio(...) not equivalent to 1.\n1/1 mismatches\n[1] 0.766 - 1 == -0.234\nError: Incorrect result for alpha_propose = 1, alpha_previous = 1, beta_propose = 20 and beta_previous = 20.\n\nFailure ('test-task-1-subtask-1-tests.R:32:3'): density_ratio()\ndensity_ratio(...) not equivalent to 0.09510128.\n1/1 mismatches\n[1] 0.766 - 0.0951 == 0.671\nError: Incorrect result for alpha_propose = 0, alpha_previous = 1, beta_propose = 20 and beta_previous = 20.\n--------------------------------------------------------------------------------\n\n== Results =====================================================================\nDuration: 0.1 s\n\n[ FAIL 3 | WARN 0 | SKIP 0 | PASS 3 ]\n\nI believe in you!\n```\n:::\n:::\n\n\n\n:::\n::::\n\n",
    "supporting": [
      "simple_template5_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}