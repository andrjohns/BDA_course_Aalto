{
  "hash": "28466fdaf08eadd974d465a755cf74f7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Assignment 9\"\nsubtitle: \"Decision analysis\"\nauthor: anonymous # <-- hand in anonymously\nformat:\n  html:\n    toc: true\n    code-tools: true\n    code-line-numbers: true\n    number-sections: true\n    mainfont: Georgia, serif\n    page-layout: article\n  pdf:  \n    geometry:\n    - left=1cm,top=1cm,bottom=1cm,right=7cm\n    number-sections: true\n    code-annotations: none\neditor: source\n---\n\n\n\n\n\n\n\n# General information\n\nThis is the template for [assignment 9](assignment9.html). You can download the [qmd-file](https://avehtari.github.io/BDA_course_Aalto/assignments/template9.qmd) or copy the code from this rendered document after clicking on `</> Code` in the top right corner.\n\n**Please replace the instructions in this template by your own text, explaining what you are doing in each exercise.** \n\n\n\n:::: {.content-hidden when-format=\"pdf\"}\n::: {.callout-warning collapse=false}\n \n## Setup\n\n\n*This block will only be visible in your HTML output, but will be hidden when rendering to PDF with quarto for the submission.*\n**Make sure that this does not get displayed in the PDF!**\n    \n\n\n\nThe following loads several needed packages:\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(bayesplot)\nlibrary(cmdstanr)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(ggdist) # for stat_dotsinterval\nlibrary(posterior)\nlibrary(brms)\n# Globally specfiy cmdstan backend for brms\noptions(brms.backend=\"cmdstanr\")\n# Tell brms to cache results if possible\noptions(brms.file_refit=\"on_change\")\n\n# Set more readable themes with bigger font for plotting packages\nggplot2::theme_set(theme_minimal(base_size = 14))\nbayesplot::bayesplot_theme_set(theme_minimal(base_size = 14))\n```\n:::\n\n\n\n\n\n\n:::\n::::\n\n\n# Escaping from the chicken coop\n\n## (a)\n\n\n:::: {.content-hidden when-format=\"pdf\"}\n::: {.callout-warning collapse=false}\n \n### A simple GP model\n\n\n*This block will only be visible in your HTML output, but will be hidden when rendering to PDF with quarto for the submission.*\n**Make sure that this does not get displayed in the PDF!**\n    \n\n\n\nThe below fits a GP model to the chicken growth curves. It may take a few minutes to fit, but you \ncan also [download the fit `.rds`-file](./additional_files/assignment9/gp_chicken_fit.rds) and work with that fit object. \n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- brm(\n  weight ~ gp(Time) + (0+Time|Diet) + (0+Time|Chick),\n  data = ChickWeight,\n  family = \"lognormal\",\n  file=\"additional_files/assignment9/gp_chicken_fit\"\n)\nbrms::pp_check(fit, type = \"intervals_grouped\", group = \"Diet\")\n```\n:::\n\n\n\n\n\n\n:::\n::::\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Useful r functions: \n#   rep(..., each=...), cbind, colMeans, \n#   posterior_predict(..., newdata=..., allow_new_levels=TRUE, sample_new_levels=\"gaussian\")\n#   ggplot, geom_line, aes(..., group=..., color=...)\n```\n:::\n\n\n\n\n\n\n\n\n:::: {.content-hidden when-format=\"pdf\"}\n::: {.callout-warning collapse=false}\n\n###  Chickenwise probability of escape function\n\n\n*This block will only be visible in your HTML output, but will be hidden when rendering to PDF with quarto for the submission.*\n**Make sure that this does not get displayed in the PDF!**\n    \n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbump <- function(x, loc=0, scale=1){\n  xi = (x - loc) / scale\n  ifelse(abs(xi) < 1, exp(-1/(1-xi^2)), 0.)\n}\ndaily_probability_of_escape <- function(day, weight){\n  # Expects a day and a weight and computes the daily probability of escape \n  bump(day, 30, 10) * (1e-2 + bump(weight, 200, 150)+bump(weight, 700, 150))\n}\nchickenwise_probability_of_escape <- function(weights){\n  # Expects a vector of daily weights from day 1 to N and computes the probability of \n  # escape at the end of the time series\n  prob_of_failure = 1\n  for(day in 1:length(weights)){\n    prob_of_failure = prob_of_failure * (1-daily_probability_of_escape(day, weights[day]))\n  }\n  return(1 - prob_of_failure)\n}\n```\n:::\n\n\n\n\n\n\n:::\n::::\n\n\n\n## (b)\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Useful r functions: chickenwise_probability_of_escape (see above)\n# rep(..., each=...), apply, \n# ggplot, stat_dotsinterval\n```\n:::\n\n\n\n\n\n\n\n\n## (c)\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Useful r functions: chickenwise_probability_of_escape (see above)\n# apply, aggregate, \n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}